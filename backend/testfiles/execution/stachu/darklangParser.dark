// Tests for the Stachu.DarklangParser - full Darklang parser using combinators

module Literals =
  // Unit
  Stachu.DarklangParser.parse "()" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EUnit, "")

  // Booleans
  Stachu.DarklangParser.parse "true" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EBool true, "")
  Stachu.DarklangParser.parse "false" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EBool false, "")

  // Int64
  Stachu.DarklangParser.parse "42L" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EInt64 42L, "")
  Stachu.DarklangParser.parse "-123L" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EInt64 (-123L), "")

  // Int8
  Stachu.DarklangParser.parse "42y" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EInt8 42y, "")

  // UInt8
  Stachu.DarklangParser.parse "255uy" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EUInt8 255uy, "")

  // Float
  Stachu.DarklangParser.parse "3.14" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EFloat(Stachu.DarklangParser.Sign.Positive, "3", "14"), "")
  Stachu.DarklangParser.parse "-2.5" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EFloat(Stachu.DarklangParser.Sign.Negative, "2", "5"), "")


module Variables =
  // Simple variable
  Stachu.DarklangParser.parse "x" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EVariable "x", "")
  Stachu.DarklangParser.parse "myVar123" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EVariable "myVar123", "")


module QualifiedNames =
  // Qualified function reference
  Stachu.DarklangParser.parse "Stdlib.List.map" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EFnName(Stachu.DarklangParser.QualifiedName { modules = ["Stdlib"; "List"]; name = "map" }), "")

  Stachu.DarklangParser.parse "MyModule.myFn" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EFnName(Stachu.DarklangParser.QualifiedName { modules = ["MyModule"]; name = "myFn" }), "")


module Enums =
  // Simple enum
  Stachu.DarklangParser.parse "Option.Some" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EEnum(Stachu.DarklangParser.QualifiedName { modules = []; name = "Option" }, "Some", []), "")

  Stachu.DarklangParser.parse "Option.None" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EEnum(Stachu.DarklangParser.QualifiedName { modules = []; name = "Option" }, "None", []), "")

  // Enum with argument
  Stachu.DarklangParser.parse "Option.Some(42L)" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EEnum(Stachu.DarklangParser.QualifiedName { modules = []; name = "Option" }, "Some", [Stachu.DarklangParser.Expr.EInt64 42L]), "")


module Lists =
  // Empty list
  Stachu.DarklangParser.parse "[]" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EList [], "")

  // List with elements
  Stachu.DarklangParser.parse "[1L; 2L; 3L]" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EList [Stachu.DarklangParser.Expr.EInt64 1L; Stachu.DarklangParser.Expr.EInt64 2L; Stachu.DarklangParser.Expr.EInt64 3L], "")


module Tuples =
  // Simple tuple
  Stachu.DarklangParser.parse "(1L, 2L)" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.ETuple(Stachu.DarklangParser.Expr.EInt64 1L, Stachu.DarklangParser.Expr.EInt64 2L, []), "")

  // Triple
  Stachu.DarklangParser.parse "(1L, 2L, 3L)" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.ETuple(Stachu.DarklangParser.Expr.EInt64 1L, Stachu.DarklangParser.Expr.EInt64 2L, [Stachu.DarklangParser.Expr.EInt64 3L]), "")


module Dicts =
  // Dict literal
  Stachu.DarklangParser.parse "Dict { x = 1L }" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EDict [("x", Stachu.DarklangParser.Expr.EInt64 1L)], "")


module InfixOperators =
  // Addition
  Stachu.DarklangParser.parse "1L + 2L" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EInfix(Stachu.DarklangParser.InfixOp.ArithmeticPlus, Stachu.DarklangParser.Expr.EInt64 1L, Stachu.DarklangParser.Expr.EInt64 2L), "")

  // Comparison
  Stachu.DarklangParser.parse "x == y" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EInfix(Stachu.DarklangParser.InfixOp.ComparisonEquals, Stachu.DarklangParser.Expr.EVariable "x", Stachu.DarklangParser.Expr.EVariable "y"), "")

  // Boolean
  Stachu.DarklangParser.parse "true && false" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EInfix(Stachu.DarklangParser.InfixOp.BooleanAnd, Stachu.DarklangParser.Expr.EBool true, Stachu.DarklangParser.Expr.EBool false), "")


module LetExpressions =
  // Simple let
  Stachu.DarklangParser.parse "let x = 5L x" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.ELet(Stachu.DarklangParser.LetPattern.LPVariable "x", Stachu.DarklangParser.Expr.EInt64 5L, Stachu.DarklangParser.Expr.EVariable "x"), "")


module IfExpressions =
  // If-then-else
  Stachu.DarklangParser.parse "if true then 1L else 2L" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EIf(Stachu.DarklangParser.Expr.EBool true, Stachu.DarklangParser.Expr.EInt64 1L, Stdlib.Option.Option.Some(Stachu.DarklangParser.Expr.EInt64 2L)), "")


module LambdaExpressions =
  // Simple lambda
  Stachu.DarklangParser.parse "fun x -> x" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.ELambda([Stachu.DarklangParser.LetPattern.LPVariable "x"], Stachu.DarklangParser.Expr.EVariable "x"), "")


module MatchExpressions =
  // Match with two cases
  Stachu.DarklangParser.parse "match x with | true -> 1L | false -> 0L" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EMatch(Stachu.DarklangParser.Expr.EVariable "x", [Stachu.DarklangParser.MatchCase { pattern = Stachu.DarklangParser.MatchPattern.MPBool true; whenCondition = Stdlib.Option.Option.None; rhs = Stachu.DarklangParser.Expr.EInt64 1L }; Stachu.DarklangParser.MatchCase { pattern = Stachu.DarklangParser.MatchPattern.MPBool false; whenCondition = Stdlib.Option.Option.None; rhs = Stachu.DarklangParser.Expr.EInt64 0L }]), "")


module PipeExpressions =
  // Simple pipe
  Stachu.DarklangParser.parse "x |> Stdlib.List.map" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.EPipe(Stachu.DarklangParser.Expr.EVariable "x", [Stachu.DarklangParser.PipeExpr.PipeFnCall(Stachu.DarklangParser.QualifiedName { modules = ["Stdlib"; "List"]; name = "map" }, [])]), "")


module FieldAccess =
  // Simple field access
  Stachu.DarklangParser.parse "x.foo" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.ERecordFieldAccess(Stachu.DarklangParser.Expr.EVariable "x", "foo"), "")

  // Chained field access
  Stachu.DarklangParser.parse "x.foo.bar" = Stachu.Parser.ParseResult.Success(Stachu.DarklangParser.Expr.ERecordFieldAccess(Stachu.DarklangParser.Expr.ERecordFieldAccess(Stachu.DarklangParser.Expr.EVariable "x", "foo"), "bar"), "")
