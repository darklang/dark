<!DOCTYPE HTML>
<html>
  <head>
    <title>Dark</title>
    <meta http-equiv="Content-Type"
          content="text/html; charset=utf-8" />
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
    <link rel="stylesheet"
          href="//{STATIC}/vendor/fontawesome-free-5.3.1-web/css/all.css"
          crossorigin="anonymous">
    <link rel="stylesheet"
          href="//{STATIC}/vendor/firacode-1.205/fira_code.css">
    <link rel="stylesheet"
          type="text/css"
          href="//{STATIC}/reset-normalize.css" />
    <link rel="stylesheet"
          type="text/css"
          href="//{STATIC}/base.css" />

    <!-- prevent favicon requests for now -->
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link rel="icon" type="image/png" sizes="32x32" href="//{STATIC}/favicon-32x32.png">
    <script type="text/javascript">
      function stopKeys(event) {
        if (event.keyCode == 9) { // Tab
          event.preventDefault();
        }
        if (event.keyCode == 32 // Space
          && !event.target.parentNode.className.includes("string-container")) {
          event.preventDefault();
        }
        if (event.keyCode == 13 // Enter
          && !event.target.parentNode.className.includes("large-string")) {
          event.preventDefault();
        }
        if (
          event.keyCode == 38 // Up
          || event.keyCode == 40 // Down
        ) {
          if (document.activeElement.tagName.toLowerCase() !== 'textarea') event.preventDefault();
        }
      }
    </script>
    <script type="text/javascript" src="//{STATIC}/bundle.js"> </script>
    <script type="text/javascript" src="//{STATIC}/darkjs.bc.js"> </script>
    <script type="text/javascript" src="//{STATIC}/darkex.js"> </script>
    {LIVERELOADJS}
    {FRONTENDIMPL}
  </head>
  <body onKeyDown="stopKeys(event)" onKeyUp="stopKeys(event)">
    <script id="analysisScript" type="javascript/worker">
      self.onmessage = function(e) {
        importScripts(e.data.proto+'//{STATIC}/darkex.js');
        importScripts(e.data.proto+'//{STATIC}/darkjs.bc.js');

        var result =
          {
            analysis: null,
            error: null
          };

        try {
          result.analysis = darkAnalysis.performAnalysis(e.data.params);
        }
        catch (error) {
          result.error = darkExe.handleAnalysisErrors(error)
        }
        postMessage(result);
      }
    </script>
    <script type="text/javascript">
      const rollbarConfig = {ROLLBARCONFIG};
      const complete = {ALLFUNCTIONS};
      const userContentHost = "{USER_CONTENT_HOST}";
      const environmentName = "{ENVIRONMENT_NAME}";

      document.title = window.location.hostname.split('.')[0] + " - Dark";

      {FRONTENDGLUE}

      class RopArrow extends HTMLElement {
        constructor() {
          super();
        }
        update() {
          var tlid = this.getAttribute("tlid");
          var target = document.querySelector(".tl-" + tlid + " .rop-rail");
          if(target) {
            const targetPos = target.getBoundingClientRect();
            const sourcePos = this.getBoundingClientRect();
            const arrowHeadLength = 12;
            const x2 = targetPos.right - sourcePos.left - arrowHeadLength;
            const x1 = x2 / 3;

            var arrowRight = document.querySelector("rop-arrow > svg > path");
            var svg = document.querySelector("rop-arrow > svg");
            svg.setAttribute("width", x2 + arrowHeadLength);

            var d = "M 0,20 C 0,8 " + x1 + ",8 " + x2 + ",15";
            arrowRight.setAttribute("d", d);
          }
        }
        connectedCallback() {
          this.update();
        }
        static get observedAttributes() {
          return ['update'];
        }
        attributeChangedCallback(attr, _, val) {
          this.update();
        }
      }
      window.customElements.define('rop-arrow', RopArrow);

    </script>
  </body>
</html>
