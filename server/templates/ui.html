<!DOCTYPE HTML>
<html>
  <head>
    <title>Dark</title>
    <meta http-equiv="Content-Type"
          content="text/html; charset=utf-8" />
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
    <link rel="stylesheet"
          href="//{STATIC}/vendor/fontawesome-free-5.3.1-web/css/all.css"
          crossorigin="anonymous">
    <link rel="stylesheet"
          href="//{STATIC}/vendor/firacode-1.205/fira_code.css">
    <link rel="stylesheet"
          type="text/css"
          href="//{STATIC}/reset-normalize.css" />
    <link rel="stylesheet"
          type="text/css"
          href="//{STATIC}/base.css" />

    <!-- prevent favicon requests for now -->
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link rel="icon" type="image/png" sizes="32x32" href="//{STATIC}/favicon-32x32.png">
    {LIVERELOADJS}
    <script type="text/javascript" src="//{STATIC}/bsmain.js"></script>
    <script type="text/javascript">

      const rollbarConfig = {ROLLBARCONFIG};
      const complete = {ALLFUNCTIONS};
      const userContentHost = "{USER_CONTENT_HOST}";
      const environmentName = "{ENVIRONMENT_NAME}";
      const csrfToken = "{CSRF_TOKEN}";

      {BUNDLEJS}
    </script>
  </head>
  <body onKeyDown="stopKeys(event)" onKeyUp="stopKeys(event)">
    <script id="analysisScript" type="javascript/worker">
      self.onmessage = function(e) {
        var result = {
          analysis: null,
          error: null
        };

        try {
          result.analysis = darkAnalysis.performAnalysis(e.data.params);
        }
        catch (error) {
          try {
            console.log("Worker has analysis error", error);
            result.error = darkExe.handleAnalysisErrors(error)
          }
          catch (error) {
            console.log ("Error handling error", error);
          }
        }
        try {
          postMessage(result);
        } catch (error) {
          console.log ("Error posting result", error, result);
        }
      }
    </script>
    <script type="text/javascript">
      let darkjsbc = fetch("//{STATIC}/darkjs.bc.js").then(r => r.text());
      let darkjsexe = fetch("//{STATIC}/darkex.js").then(r => r.text());
      var analysisWorkerUrl;
      (async function () {
        var analysisScript = document.querySelector('#analysisScript').textContent;
        window.analysisWorkerUrl = window.URL.createObjectURL(
          new Blob(
            [ await darkjsbc
            , "\n\n"
            , await darkjsexe
            , "\n\n"
            , analysisScript
            ]));
        window.analysisWorker = new Worker(analysisWorkerUrl);
      })();
    </script>
  </body>
</html>
