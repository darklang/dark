#/usr/bin/env bash

set -euo pipefail

IMAGE=gcr.io/balmy-ground-195100/dark-prod

docker tag dark-gcp:latest $IMAGE
gcloud docker -- push $IMAGE

gcloud beta compute instances update-container instance-1 \
  --container-image $IMAGE \
  --container-restart-policy=always \
  --no-container-privileged \
  --no-container-stdin \
  --no-container-tty

# TODO: persistent storage for postgres and appdata and events and
# requests
# --container-mount-host-path mount-path=/logs,host-path=/tmp,mode=rw

