#!/usr/bin/env bash

set -euo pipefail

echo "Killing running containers"
c=$(docker ps --filter "ancestor=dark-gcp:latest" -q)
if [[ ! -z "${c}" ]]; then
  docker kill "${c}";
fi

mkdir -p gcp-rundir
mkdir -p gcp-persistdir

echo "Starting new container"
docker run \
  --rm \
  -it \
  -p 8000:80 \
  --env-file config/gcp-local \
  --mount type=bind,src=$PWD/gcp-rundir,dst=/home/dark/gcp-rundir \
  --mount type=bind,src=$PWD/gcp-persistdir,dst=/home/dark/gcp-persistdir \
  -v gcp-pgconf:/etc/postgresql \
  -v gcp-pglogs:/var/log/postgresql \
  -v gcp-pgdata:/var/lib/postgresql \
  dark-gcp:latest \
  ${@}


